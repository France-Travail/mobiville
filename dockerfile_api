FROM node:12.18.4

COPY ./api /home/api
WORKDIR /home/api

CMD (which yarn || npm i -g yarn@1.15.2) && \
    if [ "$NODE_ENV" = "production" ] || [ "$NODE_ENV" = "recette" ]; then \
        echo "$NODE_ENV"; \
        yarn install --production && \
        yarn run start:production; \
    else \
        echo "$NODE_ENV"; \
        yarn install && \
        yarn start; \
    fi
